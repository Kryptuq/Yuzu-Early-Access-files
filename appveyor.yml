version: 'EA{build}'
branches:
  only:
  - main
clone_folder: c:\Projects\yuzu-early-access
image:
- Visual Studio 2019
configuration:
- Release
platform:
- x64
environment:
  matrix:
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
  - PYTHON_VERSION: 3.9
  - PYTHON_VERSION: 3.8
  - PYTHON_VERSION: 3.7
  - PYTHON_VERSION: 3.6
  - PYTHON_VERSION: 3.9
    PYTHONNET_SHUTDOWN_MODE: Soft
  - PYTHON_VERSION: 3.8
    PYTHONNET_SHUTDOWN_MODE: Soft
  - PYTHON_VERSION: 3.7
    PYTHONNET_SHUTDOWN_MODE: Soft
  - PYTHON_VERSION: 3.6
    PYTHONNET_SHUTDOWN_MODE: Soft
  
matrix:
  fast_finish: true

# skip unsupported combinations
init:
- set arch=
- if "%arch%"=="Win64" ( set arch= Win64)
- echo %arch%
- echo %APPVEYOR_BUILD_WORKER_IMAGE%
- set generator="Visual Studio 16 2019"
- echo %generator%

# Update Environment Variables based on matrix/platform
- set PY_VER=%PYTHON_VERSION:.=%
- set PYTHON=C:\PYTHON%PY_VER%
- if %PLATFORM%==x64 (set PYTHON=%PYTHON%-x64)
- set PYTHONNET_PYDLL=%PYTHON%\python%PY_VER%.dll

# Put desired Python version first in PATH
- set PATH=%PYTHON%;%PYTHON%\Scripts;%PATH%

- python -m pip install --upgrade pip
- python --version

- python setup.py --quiet sdist
- python setup.py bdist_wheel

before_build:
- cmd: |-
    mkdir build
    cd build
    pip install conan
    conan user
    cmake --version
    cmake .. -G %generator%
    
build:
  project: c:\Projects\yuzu-early-access\build\yuzu.sln
  verbosity: minimal
  parallel: true
only_commits:
  files:
    - CMakeLists.txt
    - appveyor.yml
    - source/
    - cmake/
